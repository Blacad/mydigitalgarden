---
{"date":"2024-09-26","dg-publish":true,"permalink":"/my-c-nnotes/lecture/lecture-2/","dgPassFrontmatter":true}
---

# Source 
---
PPT-ch3/ch4
# 链路层
---
- 核心内容
	- 掌握差错检测和纠正的基本原理和典型的编码方法
	- 掌握无错信道和有错信道上停等协议的设计和实现方法
	- 掌握回退N和选择重传两种典型滑动窗口协议的工作机制

## 逻辑链路控制子层 LLC
---
### 数据链路层的设计问题
---
#### 协议栈位置
---
- 向上：逻辑链路控制LLC
- 向下：介质访问控制MAC

#### 数据链路层功能
---
- ==成帧 Framing
- ==差错控制 Error Control
- 流量控制 Flow Control ，不要求

#### 数据链路的服务
---
- 无确认 无连接 服务（ Unacknowledged connectionless ）
- 有确认 无连接 服务（ Acknowledged connectionless ）
- 有确认 有连接 服务（ Acknowledged connection-oriented ）

### Framing
---
- 如何表示一个帧的开始
	- 使用 定界符
- 定界符又该怎样
	- 字节计数法（ Byte count ）
		- 基本不用，因为一个计数字节错了，后面可能都错了
	- 带字节填充的定界符法（ Flag bytes with byte stuffing ）
		- 帧开头结尾用定界符（FLAG）来区分，==因此需要在有效荷载中的特殊字符（FLAG或ESC）前全部加 转义字符（ESC）
		- 接收方处理
			- 逐个检查收到的每一个字节
			- 收到ESC 消去且后一字节无条件成为有效载荷，不予检查跳过
			- 收到FLAG 则为帧的边界
	- 带比特填充的定界符法（ Flag bits with bit stuffing ）
		- 与带字节类似，只是精细到 bits，以固定的`01111110`作为帧定界符，在有效载荷中，如果每连续连续5个1比特，则直接插入1个0比特
		- 接收方的处理
			- 若出现连续5个1比特
				- 若下一比特为0，则为有效载荷，直接丢弃0比特
				- 若下一比特为1，则连同后一比特的0，构成定界符，一帧结束
	- 物理层编码违例（ Physical layer coding violations ）
		- 物理层没有使用的编码方案作为定界符，比如4B/5B编码中就有16种没用过的编码可以用来做定界符
	- 差错控制
	- 流量控制
---
### ==差错检测和纠正==
---
#### 概述
---
- 目标：保证差错检测和纠错能力的前提下，减少冗余信息量
- 策略
	- 检错码（error-detecting code）
		- 在高可靠、误码率较低的信道，光纤
		- 通过重传解决差错问题
	- 纠错码（error-correcting code
		- 错误发生比较频繁的信道，无线
		- 纠错码的技术通常称为前向纠错
- code word 码字：一个包含m个数据位和r个校验位的n位单元
	- 描述为 (n, m) 码，n=m+r
- code rate 码率：码字中不含冗余部分所占的比例，可以用m/n表示
- Hamming distance 海明距离
	- 两个码字的海明距离：两个码字之间不同对应比特的数目
	- 一种编码方案（code）的海明距离：该编码方案中任意两个合法码字的最小海明距离
	- 检错 d errors：需要 d+1 HD
	- 纠错 d errors：需要 2d+1 HD
- 典型检错码
	- 奇偶检验parity check：1位奇偶校验是最简单、最基础的检错码，增加1位校验位，可以检查奇数位错误，只能检错1 bit错误
		- 偶校验：保证1的个数为偶数个，1为偶数则校验位为0
		- 奇校验：保证1的个数为奇数个，1为奇数则校验位为0
		- 二维可以纠错1bit错误
	- 校验和
		- 发送方：补码求和，溢出的部分置后再相加，最终取反得校验和
		- 接收方：模拟发送方将数据求和，最终与校验和相加，各位均为1则无错误
		- 示例
	- CRC
		- 能检测出少于n+1位的突发错误
		- D是原始数据，n是采用的CRC校验码位数，确定n+1位的生成多项式G(最高位幂次是n)。D先在后面加n个0，然后除G，得余数R(不足n位前面补0)即CRC校验码
		- 💡示例，码数除式的减法实际是异或运算，上位取决于前一步结果即补被除数后一位后位数是否与除数相当，如果够上1否则上0
		- 接收方看实际传输数据是否能被G整除，能则正确否则错误
- 典型纠错码
	- 设计纠错码，纠正单比特错
		- 解释第一个式子充分条件：每个合法pattern对于单比特错会产生n个其它pattern，因此需要n+1个pattern空间给每个合法pattern，合法pattern数是$2^{m}因为有m个有效信息$ 
	-  海明码
		- 纠正单比特错误
		- PPT讲述的很详细 P1 是本列和第四列，P2是本列和第四列，P4是本行和第四行，P8是本行和第四行
		- ❓海明码究竟是如何设计的，然后如何实施的，那个图怎么画✅
			- 其实不用画出这个图就可以做。海明码设计的真正高明之处就是让校验位是2的幂次位(1、2、4...)，而信息位则是剩下的位次(3、5、6、7...)，将信息位对应的位次拆开成2的幂次数的形式，就可以知道这一信息位由哪些校验位进行校验(如10=2+8，由2和8位的校验位校验)，同时校验位也知道自己的取值，即所有归该校验位校验的信息位为 1 的数量的奇偶性，默认偶校验，1的个数为偶取0，否则取0
			- 实际做题时，我们可以将所有的校验位列出来它相关的数据位，看看校验位是否正常，如果校验位不正常意味着它涉及的数据位有不正常的，正常则它涉及到的数据位都是正常的，将不正常的校验位位数相加即可得到不正常的数据位是哪一位
		- 7的得出发现，不符合的位置为1，符合的位置是0，正好是错的位置
		- 如果 kr个校验位，km个数据位，则可纠错 k位
		- 纠错过程
	- RS code
		- 以有限域运算为基础，提供多位纠错能力
		- 对于一个(n, k)RS编码，k为原始数据符号数，n-k为校验符号数
		- n-k=2t，t表示能够纠正的错误数
	- Convolutional code
		- ❓Trellis diagram（思考题）✅
			- 下方图是状态转换图只有转换不包含输出、右侧图是状态机包含转换和输出是完整的
			- 最好的方法是 各种路走并计算累积海明距离合适时间剪枝，海明距离最小的就是答案
			- 其实 卷机码最好的计算方法是通过移位寄存器的逻辑来算，由mi、mi-1、mi-2 来得到输出![Pasted image 20241103215934.png](/img/user/MyCNnotes/assets/Pasted%20image%2020241103215934.png)
				- 编码就看下方过程很简单
				- 解码同样简单，初始状态已知就一位位假设即可找hamming distance最小的

### 基本的数据链路层协议
---
- 关键假设
	- 分层进程独立假设
	- 提供可靠服务假设
	- 只处理通信错误假设
- 基本协议定义
	- frame
		- frame_kind kind
		- seq_nr seq
		- seq_nr ack
		- packet info
	- event_type
		- frame_arrival
		- cksum_err
		- timeout
- 乌托邦单工协议 --- protocol 1
	- 单工（Simplex）协议：数据单向传输
	- 完美信道：帧不会丢失或受损
	- 始终就绪：发送方/接收方的网络层始终处于就绪状态
	- 瞬间完成：发送方/接收方能够生成/处理无穷多的数据
	- 该协议不现实，假设太强
- 无错信道的停等式协议 --- protocol 2
	- 停等式协议(半双工Half-duplex)
		- 发送方发送一帧后暂停，等待确认（Ack）到达后发送下一帧
		- 接收方完成接收后，回复确认接收
		- 确认帧的内容是不重要的：哑帧（dummy frame）
- 有错信道上的单工停等式协议 --- protocol 3(half-duplex)
	- 发送方增加一个计时器(timer)，如果经过一段时间没有收到确认，发送方将超时，于是再次发送该帧
	- 用序号seq来确定包和ack的对应1bit即可，避免重复处理包副本
	- 效率评估 F、R、I、D
- protocol 4 可以使用ACK帧来携带数据，比如当接收方得到数据先不直接发送ACK而是等待一个计时器，如果计时器时间内网络层产生了要发送的帧我们就能和ACK一起正常发送出去；如果等待时间内没有产生则直接发送ACK
### 滑动窗口协议
---
- 流水线协议或管道协议：允许发送方在没收到确认前连续发送多个帧。这样能够更充分利用长管道的资源
- 窗口机制
	- 发送方和接收方都具有一定容量的缓冲区（即窗口），发送端在收到确认之前可以发送多个帧
- 滑动窗口协议 --- protocol 4
	- 循环重复使用有限的帧序号
	-  发送窗口：收到确认后窗口前移
	- 接收窗口：发送ACK窗口前移
	- 累计确认：不必对收到的分组逐个发送确认，而是对按序到达的最后一个分组发送确认
- 回退N协议 --- protocol 5[玩的网址](https://computerscience.unicam.it/marcantoni/reti/applet/GoBackProtocol/goback.html)
	- 使用累积确认机制
	- 发送窗口：收到确认后窗口前移
	- 接收窗口：发出ACK前移
	- 如果frame丢失，即当接收端收到一个出错帧或乱序帧时，丢弃所有的后继帧，并且不为这些帧发送确认
	- 如果ACK丢失，采用回前一个的ACK来解决
	- 发送端超时后，重传所有未被确认的帧并传递收到确认而上限拓展的包
	- 该策略对应接收窗口为1的情况，即只能按顺序接收帧
	- 出错全部重发时，若帧序号为n位，接收窗口WR=1，发送窗口 WT ≤ $2^{n}$－1保证重复不会接收(也就是说比如我们帧序列号有3位，那么帧编号可以0～7，但是发送窗口最大只能是6，否则可能会冗余接收)
- 选择重传协议 --- protocol 6[图示](https://www.bilibili.com/video/BV12K411F7kB/)[玩的网址](https://computerscience.unicam.it/marcantoni/reti/applet/SelectiveRepeatProtocol/selRepProt.html)
	- 没用累计确认(只重传真正丢失的分组)
	- 发送窗口：收到确认后窗口前移
	- 接收窗口：发送ACK窗口前移（buffered注意buffer时不会前移但是会发送ACK，最后统一前移）
	- 接收和发送窗口的尺寸：WT ≤$2^{n-1}$,发送窗口应等于或小于序号空间的一半（接收和发送窗口的大小是一样的）
	- NAK
- 总体而言，滑动窗口协议(窗口大小固定)发送窗口收到ACK前移，接收窗口发送ACK前移
- `说明：每个协议的具体细节还是有不同之处的，只能说基础是窗口`
### 数据链路协议实例
---
#### PPP
---
- 数据链路层的PPP协议只进行检错，PPP协议是不可靠传输协议
- PPP协议未实现点到点的流量控制
- PPP协议不支持多点线路，只支持点对点的链路通信
- PPP协议支持全双工链路
#### PPPoE
----


-----
## 介质访问控制子层 MAC
---
### ❎信道分配问题
---

### 多路访问协议
---
#### 随机访问协议
---
- 冲突不可避免
- 协议✅
	1. 纯ALOHA 协议：想发就发，冲突破坏的帧需要重传
		- N = 新产生均值、G = 重传+新产生均值
		- S 逼近于 1 越好，S=1表示帧之间无空隙
		- `说明：简单的对泊松公式的推导，我们知道泊松公式在一定程度上会弱化为二项分布，因此我们主要从二项分布的视角来看或者这么说柏松分布是极端情况的二项分布`
		- 完整的泊松分布$\frac{e^{-\lambda{T}}{({\lambda{T})}^{k}}}{k!},\lambda是单位时间内发生的期望次数、T是单位时间的个数，k是T个单位时间中真实发生的次数$
			- 泊松分布是描述一段时间内发生多次某事件的概率，对本处就是一帧时成功发出多少frame的概率
			- 有关[泊松分布](https://pangruitao.com/post/96)[二项分布](https://www.shuxuele.com/data/binomial-distribution.html)
			- 此处泊松公式的推导
				$泊松视角：G是一帧时期望的次数, k是一帧时真实次数,T=1一帧时为一划分$
				$二项式视角:n=uG,p=\frac{1}{u},u越多冲突越多,包错误在G时已经讨论过了$
		
		- 危险期：2D --- 18.4%![Pasted image 20241017113540.png](/img/user/MyCNnotes/assets/Pasted%20image%2020241017113540.png)
	2. slotted ALOHA协议：规定发送起点 --- 36.8%
		- 危险期：D
	3. CSMA
		- 非持续
		- 持续
			- 1-持续
			- p-持续
		- 冲突窗口 --- 发送站发出帧后能检测到冲突（碰撞）的最长时间 2D --- 恰好冲突时
			- CSMA/CD --- 相比CSMA增加了Jam强化信号和冲突检测
			- `说明：对方信息还未发到，主机会侦听到信道空闲而发送进而产生冲突，当侦听到冲突，立刻停止发送，主机侦听到冲突的信号有两种方式1.发送与接收间隔；2.帧太短无效`

#### 受控访问协议
---
- 克服冲突
1. 位图协议(每站都需要一个bit占用)
	- 低负荷只一人发即$\frac{d}{d+n}$、高负荷所有人都发$\frac{nd}{nd+n}$
2. 令牌协议
3. 二进制倒计数协议
	- 高序号站点优先
	- N个站的二进制编码所需位数是log2N位
	- 低负荷信道的利用率为：d/(d+log2N)、高负荷 Nd/（Nd+log2N）
#### 有限竞争协议
---
- 自适应树搜索协议
	- 逐步减少竞争的范围

### 以太网
---
- 经典以太网 - 10Mbps Manchester code
	- 由于一检测到冲突就立即中止发送，这时已经发送出去的帧数据一定小于 64 字节而正常的包是大于等于64bytes的![Pasted image 20241111183442.png](/img/user/MyCNnotes/assets/Pasted%20image%2020241111183442.png)
	- `说明:根据上图，甲从发送到意识到冲突共经历t4-t0的时间，如果恰好错开，则正好是传播时延的两倍，时延带宽积<32bytes`
	- CSMA/CD 等待随机时间后重发，随机时间由 二进制指数后退决定


- 交换式以太网
	- hub --- 同根总线，所有站都在同一冲突域
	- switch --- 每个端口独立冲突域

- fast 以太网 --- 100Mbps
	- 距离衰减
	- 64bytes限制 --- 仍然用 CSMA/CD

- 千兆以太网


### 数据链路层交换
---
- 理想的网桥是透明的，实现原理：
	- MAC地址表的构建-逆向学习源地址
		- 开始MAC地址表为空
		- 增加：A发送帧，交换机接收到了，记录A的帧传来的端口，实现逆向学习记录，如此可以记录所有的站点和对应端口的关系
		- 更新：A发送帧，网桥发现MAC_A已在表中，则更新该表项的帧达到时间，重置老化时间
		- 删除：老化时间 300s 左右，它如果未更新就删除
	
- 网桥对入境帧处理
	- Forwarding --- 不同端口发收，正常转发
	- Filter --- 同一端口发收，丢弃
	- Flooding --- 向未记录过的站发送或使用广播帧，网桥会向所有端口发送

- 交换模式
	- 存储转发模式（Store and Forward） --- 延迟大，接收整个帧后CRC检验后转发
	- 直通模式（Cut-through）--- 接收到 Destination处就直接转发
	- 无碎片模式（Fragment-free）--- 接收到64bytes后再转发，确保有效

#### 生成树协议
---
- 之前的方法 --- 冗余拓扑
	- 可靠传输
	- 代价：物理环路
		- 1 广播风暴
		- 2 重复帧
		- 3 MAC地址表不稳定

- 生成树协议
	- 通过BPDU 选举 根桥、根端口、指定端口形成生成树
		1. 选举根桥(Root Bridge) --- 每个广播域只有一个
		2. 为每个非根桥选出一个根端口（Root Port）
		3. 为每个网段确定一个指定端口
	- 断枝后会重新生成 --- Rapid Spanning Tree Protocol

#### 虚拟局域网
---
- 默认交换机是不阻隔广播域的，但是我们希望阻隔广播域 --- 通过 router 划分
- IEEE802.1Q帧中携带VLAN标志
- Access 端口 与 Trunk 端口
	- access 只能加入一个VLAN
	- trunk 允许多个VLAN的流量通过

### 无线局域网 --- 802.11
---
#### 组网模式
---
- 基础架构 --- STP、AP、DS、BSS、ESS
- Ad hoc --- STP、AP、IBSS

#### 体系架构
---

#### 介质访问控制
---
- 范围
	- TX-range --- 成功接收帧的通信范围
	- PCS-range --- 侦听范围
	- IF-range --- 干扰范围在此范围内的节点如果发送不相关的帧，将干扰接收端的接收并导致丢帧
- 隐藏终端问题
- 暴露终端问题
- 采用 CSMA/CA
- CWindow 选择 二进制指数退后算法
- CRC
- 停等式
- 帧间隙控制优先级
	- SIFS
	- PIFS
	- DIFS
- RTS-CTS机制 --- 通过信道预约，避免长帧冲突
	- 帧分段
- EDCA （了解）
	- 目标：针对不同的应用提供不同的优先级，保证QoS
#### 帧格式
---
- 域段解释
- 主要管理帧
- 主要控制帧
- 主要数据帧
#### 无线局域网的构建与管理
---
- 基础架构模式
- 针对站点 --- 看谁主动发来区分
	- 被动扫描
	- 主动扫描
- 认证过程
- 关联过程
- 自组织模式(了解)
- 站点漫游
	- 当前的AP的通道质量下降时，站点漫游到不同的AP
- 站点睡眠
#### WiFi 6 核心技术
---
- WiFi 6 --- 802.11ax 核心技术了解即可
- WiFi 5 --- 802.11ac